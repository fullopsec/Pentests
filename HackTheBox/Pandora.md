#  HTB - pandora

## Introduction
This pentest report details the findings and techniques used during the assessment of the target system with IP address 10.10.11.136. We identified open ports, services, vulnerabilities, and exploited them to gain access.

### Scanning and Enumeration

#### Nmap Scan
```bash
nmap -sV 10.10.11.136 -p-
```
![image](https://github.com/fullopsec/Pentests/assets/114147068/9c71d5d5-448f-47fd-bda3-3948499487c8)


The Nmap scan revealed the following open ports and services:

- Port 22/tcp: OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
- Port 80/tcp: Apache httpd 2.4.41 (Ubuntu)
- Port 52653/tcp: Apache httpd 2.4.41 (Ubuntu)

### Web Application Assessment

#### Web Server Enumeration
We identified two instances of Apache HTTP server running on ports 80 and 52653. Both are running version 2.4.41.

#### CMS Identification
The CMS used for the contact form is Play UIdeck.

#### Directory Bruteforcing (Dirb)
No interesting directories were found during dirb scanning.

#### Web Vulnerabilities
- Apache is vulnerable to CVE-2020-11984, but no public exploit was found.

#### SQL Injection
No SQL injection vulnerabilities were found on the web application's contact form.
![image](https://github.com/fullopsec/Pentests/assets/114147068/362eef2f-2367-401a-9f75-46ce219f66a7)
![image](https://github.com/fullopsec/Pentests/assets/114147068/1ff127bf-a38c-42bb-8b80-a6212a36dc17)


### SNMP Enumeration

We performed SNMP enumeration using Metasploit:
```bash
msf6 auxiliary(scanner/snmp/snmp_enum) > run
```
![image](https://github.com/fullopsec/Pentests/assets/114147068/9120cb52-986f-46bf-abc9-05c257556a24)

The result revealed detailed system information:
- OS: Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64
- in process list : 817 runnable sh /bin/sh -c sleep 30; /bin/bash -c '/usr/bin/host_check -u daniel -p HotelBabylon23'
ssh daniel@10.10.11.136

### SSH Exploitation
We found a runnable process with an SSH connection. We gained access to a real shell using the following command:
```bash
ssh daniel@10.10.11.136
```

### Privilege Escalation
We identified an uncommon setuid binary: `/usr/bin/pandora_backup`.

- To list setuid binaries: `find / -perm -u=s -type f 2>/dev/null`
- We only found Polkit related binaries.

### Web Application Credentials
We discovered default credentials for the web application:
`cat /var/www/pandora/pandora_console/* | grep password`
- Default user: admin
- Password: pandora

### Localhost Redirection
We redirected traffic from the target machine's localhost to ours using SSH tunneling:
```bash
ssh -f daniel@10.10.11.136 -L 2500:localhost:80 -N
```
![image](https://github.com/fullopsec/Pentests/assets/114147068/dc678e58-0134-4a22-bda1-41b6e639e006)

Accessed the Pandora console via `http://localhost:2500/pandora_console/`.

### Pandora Console Exploitation
We identified the Pandora console version as v7.0NG.742_FIX_PERL2020. Many exploits were available but required admin access.

- We connected as `daniel` with the password `HotelBabylon23` but could only use the API.
![image](https://github.com/fullopsec/Pentests/assets/114147068/1c1152d0-16ef-4f2a-a5dc-8ad86ae85aa3)

### Web Application Directory Listing (Dirb)
We found directory listings:
- http://localhost:2500/pandora_console/extras/
- http://localhost:2500/pandora_console/general/
- http://localhost:2500/pandora_console/include/

### Exploitable Files
We identified a file that should have been deleted: `operation/servers/recon_view.php`.

### Web Application Debug Information
We found debug information in `http://localhost:2500/pandora_console/extras/sample_login.php`, revealing credentials:
- User: admin
- Password: sistemas
![image](https://github.com/fullopsec/Pentests/assets/114147068/2f0f7bcb-85dc-4313-8946-a2ffd2d9130c)

### Chart Generator Vulnerability
In the `/include/chart_generator.php`, we discovered a SQL injection vulnerability with the injectable parameter `session_id`. We exploited this vulnerability using SQLmap.
`sqlmap http://localhost:2500/pandora_console/include/chart_generator.php?session_id= --dbs pandora --tables`


- Retrieved databases: `--dbs pandora`
- Tables: `tpassword_history` (Interesting)
![image](https://github.com/fullopsec/Pentests/assets/114147068/80c1c2ab-12ed-41b9-a82b-7abd250adcba)

### Password History Extraction
We extracted password history from the `tpassword_history` table using SQLmap.

### Session ID Extraction
We extracted session IDs from the `tsessions_php` table using SQLmap.
`sqlmap "http://localhost:2500/pandora_console/include/chart_generator.php?session_id=''" -D pandora -T tsessions_php --dump`
![image](https://github.com/fullopsec/Pentests/assets/114147068/9e7fe730-9aea-4ce5-929d-3f525f8942d4)
34pd154su0stc3ve5bto474338 session id is admin


### Reverse Shell Upload
We uploaded a PHP reverse shell via the web interface and connected as the user `matt`.

This concludes the pentest report for the target system with IP address 10.10.11.136. Further actions may include privilege escalation and lateral movement within the network.
