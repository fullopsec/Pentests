
# HTB RouterSpace

## Introduction

This penetration test report covers the assessment of a target with IP address 10.129.172.73. The target has two open ports: 22 (SSH) and 80 (HTTP).

## Nmap Scans

### Initial Port Scan

The initial port scan was performed using Nmap to identify open ports on the target:

```shell
nmap -sV 10.129.172.73 -p-
```

- Port 22/tcp: Open SSH (protocol 2.0)
- Port 80/tcp: Open HTTP

### Nmap with Vulners Script

An attempt was made to scan for vulnerabilities using the Vulners script, but a protection system was detected.

```shell
nmap -sV 10.129.172.73 -p- --script /usr/share/nmap/scripts/vulners.nse
```

### Directory Busting

Protection system cause false positives

![image](https://github.com/fullopsec/Pentests/assets/114147068/fdeb8f35-c8c9-4181-a7d9-fc4786315e05)


## Web Assessment

Upon visiting the HTTP service on port 80, it was identified that the website uses the Colorlib template for WordPress. However, running WPScan did not detect the presence of WordPress:


![image](https://github.com/fullopsec/Pentests/assets/114147068/837d650a-5cf3-4d18-9e83-fa22a6d35462)

![image](https://github.com/fullopsec/Pentests/assets/114147068/3cc00b30-05b9-4488-9c97-35a933212d0f)


## Android App Analysis

An APK file named "RouterSpace.apk" was downloaded and analyzed. The following steps were taken:

1. The APK was decompiled using apktool:
   
   ```shell
   apktool -d /home/daniel/Downloads/RouterSpace.apk
   ```

2. An Android emulator (Anbox) was set up to emulate an Android system for further analysis. Installation instructions can be found [here](https://dev.to/sbellone/how-to-install-anbox-on-debian-1hjd).

3. When installing F-Droid on the emulator, the ADB server was started:

   ```shell
   adb kill-server
   adb start-server
   ```

4. A proxy was set up to listen on the Anbox IP:

   ![image](https://github.com/fullopsec/Pentests/assets/114147068/b40d5c45-3ddd-4682-bb26-aeb13fafbf7a)


   ```shell
   adb shell settings put global http_proxy 192.168.250.1:6666
   ```

   Add the proxy in Burp

   ![image](https://github.com/fullopsec/Pentests/assets/114147068/4471e795-9fbd-4cf8-a68d-79fc935bf648)


   


5. The Android app was found to send a POST request to `/api/v4/monitoring/router/dev/check/deviceAccess` with the following JSON data:

   ```json
   {"ip":"0.0.0.0"}
   ```

   ![image](https://github.com/fullopsec/Pentests/assets/114147068/a7082845-9fab-495a-8041-1aeabf6024f1)


6. Attempts were made to execute commands by modifying the JSON data, but only certain parameters, such as "&" allowed the execution of the commands.


![image](https://github.com/fullopsec/Pentests/assets/114147068/2af6fd30-4d83-4728-bdac-3e3548e82e33)


![image](https://github.com/fullopsec/Pentests/assets/114147068/5a91e69e-405d-4175-ba26-42f43561e6ba)



## Gaining SSH Access

It was discovered that the user "Paul" had an SSH folder.

![image](https://github.com/fullopsec/Pentests/assets/114147068/669cf2e2-1e50-46ff-8f55-2ccca54cdf16)


A new SSH key pair was generated on the attacker's machine and added to the trusted keys of user "Paul" to gain SSH access.


- Generating SSH key pair:

   ```shell
   ssh-keygen
   ```

![image](https://github.com/fullopsec/Pentests/assets/114147068/316688cd-ed90-4ea0-b8ca-a318471cf3ac)


- Copying the public key and adding it to trusted keys:

   ```shell
   &echo 'ssh rsa <public_key>' >> /home/paul/.ssh/authorized_keys
   ```

![image](https://github.com/fullopsec/Pentests/assets/114147068/e2e1cc66-5f13-4720-92de-5d1d86c224c7)


7. SSH access was successfully achieved as "Paul."


 ![image](https://github.com/fullopsec/Pentests/assets/114147068/3c0ed5e8-bcf2-41b5-a6e6-d5798b0ccedb)


## Privilege Escalation

### Linpeas

An investigation into potential privilege escalation revealed a vulnerable version of sudo (version 1.8.31). 

`-rwsr-xr-x 1 root root 163K Feb 3 2020 /usr/bin/sudo ---> check_if_the_sudo_version_is_vulnerable`

![image](https://github.com/fullopsec/Pentests/assets/114147068/07cd36b6-9b7e-4b37-9ffa-0a9332a4f013)

### Exploiting sudo

This version was found to be vulnerable according to online sources.

![image](https://github.com/fullopsec/Pentests/assets/114147068/40bef614-b1db-4d9c-8817-c06171f01e5e)


 An exploit targeting the vulnerable sudo version (CVE-2021-3156) was executed, leading to privilege escalation.

   ![image](https://github.com/fullopsec/Pentests/assets/114147068/7766bf67-5757-4085-8ef2-0df12eca8ccc)


   ![image](https://github.com/fullopsec/Pentests/assets/114147068/073bbe3b-3b56-4f6e-b3b1-bfab62624902)



## Conclusion

In conclusion, the penetration test identified vulnerabilities in the target app API adn sudo version, allowing for SSH access and eventual privilege escalation. The vulnerabilities were successfully exploited to gain unauthorized access to the target system.



