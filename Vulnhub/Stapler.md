# Vulnhub - Stapler

Pentest conducted on Stapler. The report outlines the commands and findings during the assessment. 

## Initial Network Discovery
- **Command:** `netdiscover -r 192.168.1.0/24`
- **Findings:** Discovered the target at IP address 192.168.1.27 



## Port Scanning and Service Enumeration
- **Command:** `nmap 192.168.1.27 -sV -A -p-`
- **Findings:** Found several open ports, including 20, 21, 22, 53, 80, 139, 666, and 3306. Additionally, identified that port 12380 is open, running Apache httpd 2.4.18 on an Ubuntu system.

![image](https://github.com/fullopsec/Pentests/assets/114147068/2726d274-8b46-4519-8169-9153c233cbef)



## Anonymous FTP Login
- **Findings:** Anonymous FTP login is allowed with the username 'ftp' and no password required.

![image](https://github.com/fullopsec/Pentests/assets/114147068/2dffc410-51fa-4a87-a619-781762ffecab)

![image](https://github.com/fullopsec/Pentests/assets/114147068/f59f20a8-6d27-4c16-8cbd-305f91fb852c)


### Discovery of User Accounts
- **Findings:** Discovered potential user accounts named 'harry' 'Elly' and 'John' from a note in the FTP server.

![image](https://github.com/fullopsec/Pentests/assets/114147068/3c9ebc75-7027-45f1-96c3-ade5a8763463)


## Directory Bruteforcing on Port 80
- **Description:** Executed `dirb` on port 80 to discover hidden directories on the web server.
- **Findings:** Identified a bash alias file and potentially other hidden directories.

![image](https://github.com/fullopsec/Pentests/assets/114147068/6e0c68cb-7c72-4154-ab22-8f90e3736f4e)

![image](https://github.com/fullopsec/Pentests/assets/114147068/38de1f88-9fcd-4310-95ae-119c8258909d)

## WordPress Scanning with WPScan
- **Command:** `wpscan --url https://192.168.1.27:12380/blogblog/ --disable-tls-checks --enumerate u`
- **Findings:** Discovered multiple user accounts associated with the WordPress site, including 'tim,' 'kathy,' 'scott,' 'harry,' 'garry,' 'heather,' 'barry,' 'peter,' 'elly,' and 'John Smith.'

## SMB Enumeration
- **Command:** `smbclient -L <server>` to list shares and `smbclient //192.168.1.27/kathy` to connect to the 'kathy' share.
- **Findings:** Listed the contents of the 'kathy' share, including files and directories.

## WordPress Bruteforcing
- **Findings:** Bruteforcing via Metasploit we discovered a login and password : john:incorrect

## WordPress Plugin Upload and Metasploit Exploitation
- **Description:** Uploaded a fake WordPress plugin via john account and exploited it using Metasploit. (https://docs.j7k6.org/wordpress-malicious-plugin-reverse-shell-metasploit/)
- We then have to execute `https://192.168.1.27:12380/blogblog/wp-content/uploads/PATH OF YOUR SHELL`
- **Findings:** Successfully gained a Meterpreter session, establishing a shell on the target system. Upgraded the shell to a full terminal.

## SUID and Privilege Escalation
- **Command:** `find / -perm -u=s -type f 2>/dev/null` to search for SUID binaries.
- **Findings:** No GTFOBins available for the machine. Potential privilege escalation path is not identified.

## pspy Process Monitoring
- **Description:** Ran the `pspy` tool to monitor running processes.
- **Findings:** Monitored various processes, including atftpd, bash, nc, mysqld, and more.


## SSH Login and Privilege Escalation
- **Command:** `cat /home/*/.bash_his*`
  
Result :

```
sshpass -p thisimypassword ssh JKanode@localhost
apt-get install sshpass
sshpass -p JZQuyIN5 peter@localhost
connect to peter and sudo su and you are root
```

- **Findings:** Successfully connected to user 'peter' via SSH and escalated privileges to root using `sudo su` as peter.

## Additional Resources

- [Google Search for Linux Privilege Escalation](https://www.google.com/search?q=linux-privilege-escalation+from+www+data)
- [Linux Exploit Suggester](https://github.com/mzet-/linux-exploit-suggester)

## Conclusion

In conclusion, the penetration test of the Vulnhub machine "Stapler" uncovered various vulnerabilities, including an anonymous FTP login, a WordPress website susceptible to bruteforcing and plugin exploitation, and privilege escalation via insecure bash history.
